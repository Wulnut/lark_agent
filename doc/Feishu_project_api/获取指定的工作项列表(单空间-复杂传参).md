<!--
 * @Author: liangyz liangyz@seirobotics.net
 * @Date: 2026-01-14
 * @LastEditors: liangyz liangyz@seirobotics.net
 * @LastEditTime: 2026-01-14
 * @FilePath: /lark_agent/doc/Feishu_project_api/获取指定的工作项列表(单空间-复杂传参).md
 * @Description: 获取指定的工作项列表（单空间-复杂传参）API文档
-->

ref: https://project.feishu.cn/b/helpcenter/1p8d7djs/19pti4e2

# 获取指定的工作项列表（单空间-复杂传参）

## 接口概述

该接口用于在单个项目空间内，通过复杂的搜索条件（支持多字段组合、AND/OR逻辑、多种操作符）获取指定的工作项列表。

**接口路径**: `POST /open_api/{project_key}/work_item/{type_key}/search/params`

**认证方式**: 需要在请求头中携带 `X-PLUGIN-TOKEN` 和 `X-USER-KEY`

## 路径参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `project_key` | string | 是 | 项目空间的唯一标识符 |
| `type_key` | string | 是 | 工作项类型标识符（如 "task", "issue", "story" 等） |

## 请求体参数

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `search_group` | object | 是 | 搜索条件组，支持嵌套逻辑 |
| `page_num` | integer | 否 | 页码，从1开始，默认为1 |
| `page_size` | integer | 否 | 每页数量，默认为20 |
| `fields` | array[string] | 否 | 指定返回的字段列表，不指定则返回所有字段 |

### search_group 结构

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `conjunction` | string | 是 | 逻辑连接符，可选值：`"AND"` 或 `"OR"` |
| `search_params` | array[object] | 否 | 搜索参数列表 |
| `search_groups` | array[object] | 否 | 嵌套的搜索条件组（支持递归嵌套） |

### search_params 元素结构

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `field_key` | string | 是 | 字段标识符（如 "priority", "owner", "status" 等） |
| `operator` | string | 是 | 操作符（见下方操作符说明） |
| `value` | any | 是 | 操作值，类型取决于操作符 |

## 支持的操作符

| 操作符 | 说明 | value 类型 | 示例 |
|--------|------|-----------|------|
| `IN` | 包含于 | array | `["option_1", "option_2"]` |
| `NOT_IN` | 不包含于 | array | `["option_1"]` |
| `EQ` | 等于 | string/number | `"value"` 或 `100` |
| `NE` | 不等于 | string/number | `"value"` 或 `100` |
| `GT` | 大于 | number | `1000` |
| `LT` | 小于 | number | `2000` |
| `GE` | 大于等于 | number | `1000` |
| `LE` | 小于等于 | number | `2000` |
| `LIKE` | 模糊匹配 | string | `"关键词"` |
| `IS_NULL` | 为空 | null | `null` |
| `IS_NOT_NULL` | 不为空 | null | `null` |

## 请求示例

### 基础示例：单条件查询

查询优先级为 "高" 的工作项：

```json
{
    "search_group": {
        "conjunction": "AND",
        "search_params": [
            {
                "field_key": "priority",
                "operator": "IN",
                "value": ["option_3"]
            }
        ],
        "search_groups": []
    },
    "page_num": 1,
    "page_size": 20
}
```

### 多条件组合（AND）

查询优先级为 "高" 且创建者为指定用户的工作项：

```json
{
    "search_group": {
        "conjunction": "AND",
        "search_params": [
            {
                "field_key": "priority",
                "operator": "IN",
                "value": ["option_3"]
            },
            {
                "field_key": "created_by",
                "operator": "IN",
                "value": ["user_id_123"]
            }
        ],
        "search_groups": []
    },
    "page_num": 1,
    "page_size": 20
}
```

### 嵌套条件（AND + OR）

查询优先级为 "高"，且负责人为用户1或用户2的工作项：

```json
{
    "search_group": {
        "conjunction": "AND",
        "search_params": [
            {
                "field_key": "priority",
                "operator": "IN",
                "value": ["option_3"]
            }
        ],
        "search_groups": [
            {
                "conjunction": "OR",
                "search_params": [
                    {
                        "field_key": "owner",
                        "operator": "IN",
                        "value": ["user_1"]
                    },
                    {
                        "field_key": "owner",
                        "operator": "IN",
                        "value": ["user_2"]
                    }
                ],
                "search_groups": []
            }
        ]
    },
    "page_num": 1,
    "page_size": 20
}
```

### 指定返回字段

只返回工作项的名称、优先级和状态字段：

```json
{
    "search_group": {
        "conjunction": "AND",
        "search_params": [
            {
                "field_key": "priority",
                "operator": "IN",
                "value": ["option_3"]
            }
        ],
        "search_groups": []
    },
    "fields": ["name", "priority", "status"],
    "page_num": 1,
    "page_size": 20
}
```

### 时间范围查询

查询创建时间在指定范围内的工作项：

```json
{
    "search_group": {
        "conjunction": "AND",
        "search_params": [
            {
                "field_key": "created_at",
                "operator": "GE",
                "value": 1600000000000
            },
            {
                "field_key": "created_at",
                "operator": "LE",
                "value": 1700000000000
            }
        ],
        "search_groups": []
    },
    "page_num": 1,
    "page_size": 20
}
```

### 模糊匹配查询

查询名称包含关键词的工作项：

```json
{
    "search_group": {
        "conjunction": "AND",
        "search_params": [
            {
                "field_key": "name",
                "operator": "LIKE",
                "value": "关键词"
            }
        ],
        "search_groups": []
    },
    "page_num": 1,
    "page_size": 20
}
```

## 响应格式

### 成功响应

```json
{
    "err_code": 0,
    "err_msg": "success",
    "data": {
        "work_items": [
            {
                "id": 123456789,
                "name": "工作项名称",
                "priority": "option_3",
                "status": "status_1",
                "owner": "user_id",
                "created_at": 1600000000000,
                ...
            }
        ],
        "total": 100,
        "page_num": 1,
        "page_size": 20
    }
}
```

**注意**: 某些情况下，`data` 字段可能直接返回数组格式：

```json
{
    "err_code": 0,
    "err_msg": "success",
    "data": [
        {
            "id": 123456789,
            "name": "工作项名称",
            ...
        }
    ]
}
```

### 错误响应

```json
{
    "err_code": 1001,
    "err_msg": "错误信息描述",
    "data": null
}
```

## 响应字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `err_code` | integer | 错误码，0表示成功 |
| `err_msg` | string | 错误信息 |
| `data` | object/array | 响应数据 |
| `data.work_items` | array | 工作项列表 |
| `data.total` | integer | 总记录数 |
| `data.page_num` | integer | 当前页码 |
| `data.page_size` | integer | 每页数量 |

## 特点与优势

1. **灵活的查询条件**: 支持多字段组合查询
2. **逻辑组合**: 支持 AND/OR 嵌套逻辑
3. **丰富的操作符**: 支持等于、包含、范围、模糊匹配等多种操作
4. **字段筛选**: 可指定返回字段，减少数据传输量
5. **分页支持**: 支持分页查询，适合大数据量场景

## 使用场景

- 需要按多个字段组合查询工作项
- 需要复杂的逻辑条件（如：优先级高 AND (负责人A OR 负责人B)）
- 需要精确控制返回的字段
- 需要按时间范围、数值范围等条件查询

## 注意事项

1. `type_key` 必须是有效的、已存在的工作项类型标识符
2. `field_key` 必须是该工作项类型支持的字段标识符
3. `value` 的类型必须与操作符和字段类型匹配
4. 嵌套的 `search_groups` 支持递归，但建议不要嵌套过深
5. 当 `fields` 参数为空或不指定时，返回所有字段
6. 分页参数 `page_num` 从1开始计数

## 相关接口

- [单空间基础过滤](./工作项过滤方法汇总.md#1-单空间基础过滤-filter): `POST /open_api/{project_key}/work_item/filter`
- [跨空间过滤](./工作项过滤方法汇总.md#2-跨空间过滤-filter_across_project): `POST /open_api/work_items/filter_across_project`
- [全局搜索](./工作项过滤方法汇总.md#4-全局搜索-compositive_search): `POST /open_api/compositive_search`
- [关联工作项查询](./工作项过滤方法汇总.md#5-关联工作项查询-search_by_relation): `POST /open_api/{project_key}/work_item/{type_key}/{id}/search_by_relation`

## 代码示例

### Python 示例

```python
import httpx

async def search_work_items(
    client: httpx.AsyncClient,
    project_key: str,
    type_key: str,
    search_group: dict,
    page_num: int = 1,
    page_size: int = 20,
    fields: list = None
):
    """使用复杂参数搜索工作项"""
    url = f"/open_api/{project_key}/work_item/{type_key}/search/params"
    payload = {
        "search_group": search_group,
        "page_num": page_num,
        "page_size": page_size,
    }
    if fields:
        payload["fields"] = fields

    response = await client.post(url, json=payload)
    response.raise_for_status()
    data = response.json()

    if data.get("err_code") != 0:
        raise Exception(f"搜索失败: {data.get('err_msg')}")

    result = data.get("data", {})
    # 兼容不同的返回格式
    if isinstance(result, list):
        return {"work_items": result, "total": len(result)}
    return result
```

## 参考文档

- [飞书项目帮助中心](https://project.feishu.cn/b/helpcenter/1p8d7djs/19pti4e2)
- [工作项过滤方法汇总](./格式说明/工作项过滤方法汇总.md)
- [搜索参数格式及常用示例](./格式说明/搜索参数格式及常用示例.md)
